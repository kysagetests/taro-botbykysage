import aiohttp
import random
from datetime import datetime
from typing import List
import logging

logger = logging.getLogger(__name__)


class OllamaAssistant:
    def __init__(self, ollama_url: str, model: str):
        self.ollama_url = ollama_url
        self.model = model

        self.tarot_cards = [
            "–®—É—Ç", "–ú–∞–≥", "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä",
            "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "–°–∏–ª–∞", "–û—Ç—à–µ–ª—å–Ω–∏–∫",
            "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "–°–º–µ—Ä—Ç—å",
            "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", "–î—å—è–≤–æ–ª", "–ë–∞—à–Ω—è", "–ó–≤–µ–∑–¥–∞", "–õ—É–Ω–∞", "–°–æ–ª–Ω—Ü–µ",
            "–°—É–¥", "–ú–∏—Ä"
        ]

        self.zodiac_signs = {
            (1, 20): "–ö–æ–∑–µ—Ä–æ–≥", (2, 19): "–í–æ–¥–æ–ª–µ–π", (3, 21): "–†—ã–±—ã",
            (4, 20): "–û–≤–µ–Ω", (5, 21): "–¢–µ–ª–µ—Ü", (6, 21): "–ë–ª–∏–∑–Ω–µ—Ü—ã",
            (7, 23): "–†–∞–∫", (8, 23): "–õ–µ–≤", (9, 23): "–î–µ–≤–∞",
            (10, 23): "–í–µ—Å—ã", (11, 22): "–°–∫–æ—Ä–ø–∏–æ–Ω", (12, 22): "–°—Ç—Ä–µ–ª–µ—Ü",
            (12, 31): "–ö–æ–∑–µ—Ä–æ–≥"
        }

    def get_zodiac_sign(self, birth_date: datetime) -> str:
        day = birth_date.day
        month = birth_date.month

        for (m, d), sign in self.zodiac_signs.items():
            if (month == m and day <= d) or (month == m - 1 and day > d):
                return sign
        return "–ö–æ–∑–µ—Ä–æ–≥"

    def draw_cards(self, count: int = 3) -> List[str]:
        return random.sample(self.tarot_cards, count)

    async def generate_tarot_prediction(self, name: str, birth_date: str, zodiac_sign: str, cards: List[str]) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è"""

        prompt = f"""
–¢–´ –¢–ê–†–û–õ–û–ì. –û–¢–í–ï–ß–ê–ô –°–¢–†–û–ì–û –ù–ê –†–£–°–°–ö–û–ú. –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô –ê–ù–ì–õ–ò–ô–°–ö–ò–ô.

–ò–º—è: {name}
–ó–Ω–∞–∫: {zodiac_sign}
–ö–∞—Ä—Ç—ã: {", ".join(cards)}

–ù–∞–ø–∏—à–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

üîÆ –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: [2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]
üí´ –ö–∞—Ä—Ç—ã: [–∫–æ—Ä–æ—Ç–∫–æ –æ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–µ]  
üåü –°–æ–≤–µ—Ç: [1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]
‚ö° –ë—É–¥—É—â–µ–µ: [1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

–ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û –†–£–°–°–ö–ò–ô –Ø–ó–´–ö –ò –≠–ú–û–î–ó–ò.
"""

        try:
            logger.info(f"üîÆ –ó–∞–ø—Ä–æ—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–ª—è {name}")

            async with aiohttp.ClientSession(timeout=aiohttp.ClientTimeout(total=20)) as session:
                data = {
                    "model": self.model,
                    "prompt": prompt,
                    "stream": False,
                    "options": {
                        "temperature": 0.7,
                        "num_predict": 250,
                        "top_k": 20,
                        "top_p": 0.8
                    }
                }

                async with session.post(f"{self.ollama_url}/api/generate", json=data) as response:

                    if response.status == 200:
                        result = await response.json()
                        response_text = result.get("response", "").strip()

                        if response_text:
                            cleaned_text = self._force_russian(response_text)
                            if self._is_russian(cleaned_text):
                                logger.info(f"‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è {name}")
                                return cleaned_text
                            else:
                                return self._get_russian_prediction(name, cards, zodiac_sign)
                        else:
                            return self._get_russian_prediction(name, cards, zodiac_sign)
                    else:
                        return self._get_russian_prediction(name, cards, zodiac_sign)

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: {e}")
            return self._get_russian_prediction(name, cards, zodiac_sign)

    async def generate_detailed_explanation(self, name: str, birth_date: str, zodiac_sign: str, cards: List[str],
                                            original_prediction: str) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è"""

        prompt = f"""
–¢–´ –≠–ö–°–ü–ï–†–¢-–¢–ê–†–û–õ–û–ì. –î–ê–ô –†–ê–°–®–ò–†–ï–ù–ù–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–Ø –ù–ê –†–£–°–°–ö–û–ú.

–ò–ù–§–û–†–ú–ê–¶–ò–Ø:
- –ò–º—è: {name}
- –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {zodiac_sign}
- –ö–∞—Ä—Ç—ã: {", ".join(cards)}
- –ò—Å—Ö–æ–¥–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ: {original_prediction}

–î–ê–ô –ü–û–î–†–û–ë–ù–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï –í –§–û–†–ú–ê–¢–ï:

üé≠ –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ê–°–ü–ï–ö–¢: [–∫–∞–∫ –∫–∞—Ä—Ç—ã –æ—Ç—Ä–∞–∂–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ]
üåå –ö–ê–†–ú–ò–ß–ï–°–ö–ò–ï –°–í–Ø–ó–ò: [—Å–≤—è–∑—å —Å –ø—Ä–æ—à–ª—ã–º –∏ –±—É–¥—É—â–∏–º]
üîó –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –ö–ê–†–¢: [–∫–∞–∫ –∫–∞—Ä—Ç—ã —É—Å–∏–ª–∏–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞]
üìú –°–ò–ú–í–û–õ–ò–ó–ú: [–≥–ª—É–±–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤]

–ë–£–î–¨ –ì–õ–£–ë–û–ö–ò–ú –ò –ú–£–î–†–´–ú. –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û –†–£–°–°–ö–ò–ô –Ø–ó–´–ö.
"""

        try:
            logger.info(f"üìñ –ó–∞–ø—Ä–æ—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è –¥–ª—è {name}")

            async with aiohttp.ClientSession(timeout=aiohttp.ClientTimeout(total=25)) as session:
                data = {
                    "model": self.model,
                    "prompt": prompt,
                    "stream": False,
                    "options": {
                        "temperature": 0.8,
                        "num_predict": 400,  # –ë–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
                        "top_k": 30,
                        "top_p": 0.85
                    }
                }

                async with session.post(f"{self.ollama_url}/api/generate", json=data) as response:

                    if response.status == 200:
                        result = await response.json()
                        response_text = result.get("response", "").strip()

                        if response_text and self._is_russian(response_text):
                            logger.info(f"‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è {name}")
                            return self._clean_explanation(response_text)
                        else:
                            return self._get_detailed_fallback(name, cards, zodiac_sign, original_prediction)
                    else:
                        return self._get_detailed_fallback(name, cards, zodiac_sign, original_prediction)

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è: {e}")
            return self._get_detailed_fallback(name, cards, zodiac_sign, original_prediction)

    def _clean_explanation(self, text: str) -> str:
        """–û—á–∏—â–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ"""
        lines = text.split('\n')
        cleaned_lines = []

        for line in lines:
            line_lower = line.lower()
            if any(phrase in line_lower for phrase in ['of course', 'certainly', 'here is', 'explanation:']):
                continue
            if line.strip():
                cleaned_lines.append(line)

        return '\n'.join(cleaned_lines).strip()

    def _get_detailed_fallback(self, name: str, cards: List[str], zodiac_sign: str, original_prediction: str) -> str:
        """–†–µ–∑–µ—Ä–≤–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ"""

        explanations = [
            f"""üé≠ *–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç:* 
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∫–∞—Ä—Ç {', '.join(cards)} –æ—Ç—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ –≥–ª—É–±–æ–∫–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–æ–∑–Ω–∞–Ω–∏—è. –í—ã —Å—Ç–æ–∏—Ç–µ –Ω–∞ –ø–æ—Ä–æ–≥–µ –≤–∞–∂–Ω—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

üåå *–ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏:*
–ö–∞–∫ {zodiac_sign.lower()}, –≤—ã –æ—Å–æ–±–µ–Ω–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–º –ø–æ—Ç–æ–∫–∞–º. –≠—Ç–∏ –∫–∞—Ä—Ç—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –æ—Ç—Ä–∞–±–æ—Ç–∫—É –∫–∞—Ä–º–∏—á–µ—Å–∫–∏—Ö —É—Ä–æ–∫–æ–≤.

üîó *–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–∞—Ä—Ç:*
–ö–∞—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç –º–æ—â–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑–æ–Ω–∞–Ω—Å, —É—Å–∏–ª–∏–≤–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –∏ —Å–æ–∑–¥–∞–≤–∞—è —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –≤–ª–∏—è–Ω–∏–π.

üìú *–°–∏–º–≤–æ–ª–∏–∑–º:*
–ö–∞–∂–¥–∞—è –∫–∞—Ä—Ç–∞ –Ω–µ—Å–µ—Ç –¥—Ä–µ–≤–Ω—é—é –º—É–¥—Ä–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ –≤–∞—à–µ–º —Ç–µ–∫—É—â–µ–º –∂–∏–∑–Ω–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.""",

            f"""üé≠ *–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç:*
–î–∞–Ω–Ω–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –∫–∞—Ä—Ç —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –ø–æ–∏—Å–∫–µ –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–∏ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏. –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞–∂–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∏–π.

üåå *–ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏:*
–í–∞—à –∑–Ω–∞–∫ {zodiac_sign} —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∫–∞—Ä–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –ø–æ–º–æ–≥–∞—è –ø–æ–Ω—è—Ç—å –≥–ª—É–±–∏–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π.

üîó *–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–∞—Ä—Ç:*
–°–æ—á–µ—Ç–∞–Ω–∏–µ {', '.join(cards)} —Å–æ–∑–¥–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –±—ã—Å—Ç—Ä—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

üìú *–°–∏–º–≤–æ–ª–∏–∑–º:*
–°–∏–º–≤–æ–ª–∏–∫–∞ –≤—ã–ø–∞–≤—à–∏—Ö –∫–∞—Ä—Ç —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∞—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–µ –æ–±—Ä–∞–∑—ã, –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –ø—É—Ç–∏."""
        ]

        return random.choice(explanations)

    def _force_russian(self, text: str) -> str:
        """–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç —Ç–µ–∫—Å—Ç —Ä—É—Å—Å–∫–∏–º"""
        english_phrases = [
            "of course", "certainly", "here is", "prediction:", "answer:",
            "the cards", "tarot reading", "energy", "advice", "future"
        ]

        lines = text.split('\n')
        cleaned_lines = []

        for line in lines:
            line_lower = line.lower()
            if any(phrase in line_lower for phrase in english_phrases):
                continue

            line = (line
                    .replace('energy', '—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞')
                    .replace('Energy', '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞')
                    .replace('cards', '–∫–∞—Ä—Ç—ã')
                    .replace('Cards', '–ö–∞—Ä—Ç—ã')
                    .replace('advice', '—Å–æ–≤–µ—Ç')
                    .replace('Advice', '–°–æ–≤–µ—Ç')
                    .replace('future', '–±—É–¥—É—â–µ–µ')
                    .replace('Future', '–ë—É–¥—É—â–µ–µ')
                    .replace('reading', '–≥–∞–¥–∞–Ω–∏–µ')
                    .replace('Reading', '–ì–∞–¥–∞–Ω–∏–µ'))

            if line.strip():
                cleaned_lines.append(line)

        result = '\n'.join(cleaned_lines).strip()

        if not result or len(result) < 50:
            return self._get_russian_prediction("", [], "")

        return result

    def _is_russian(self, text: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫"""
        if not text:
            return False

        russian_chars = set('–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è')
        text_lower = text.lower()
        russian_count = sum(1 for char in text_lower if char in russian_chars)
        total_alpha = sum(1 for char in text_lower if char.isalpha())

        return total_alpha > 10 and (russian_count / total_alpha) > 0.7

    def _get_russian_prediction(self, name: str, cards: List[str], zodiac_sign: str) -> str:
        """–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä—É—Å—Å–∫–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ"""

        card_meanings = {
            "–®—É—Ç": "üÉè –ù–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è –∏ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å",
            "–ú–∞–≥": "üîÆ –°–∏–ª–∞ –≤–æ–ª–∏ –∏ —Å–æ–∑–∏–¥–∞–Ω–∏–µ",
            "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞": "üåô –ò–Ω—Ç—É–∏—Ü–∏—è –∏ —Ç–∞–π–Ω—ã",
            "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞": "üåø –ò–∑–æ–±–∏–ª–∏–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ",
            "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä": "üèõÔ∏è –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
            "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç": "üìú –î—É—Ö–æ–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏",
            "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ": "üíñ –õ—é–±–æ–≤—å –∏ –≤–∞–∂–Ω—ã–π –≤—ã–±–æ—Ä",
            "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞": "‚ö° –î–≤–∏–∂–µ–Ω–∏–µ –∏ –ø–æ–±–µ–¥–∞",
            "–°–∏–ª–∞": "ü¶Å –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞ –∏ –º—É–∂–µ—Å—Ç–≤–æ",
            "–û—Ç—à–µ–ª—å–Ω–∏–∫": "üïØÔ∏è –ú—É–¥—Ä–æ—Å—Ç—å –∏ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑",
            "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã": "üé° –°—É–¥—å–±–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω—ã",
            "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å": "‚öñÔ∏è –ë–∞–ª–∞–Ω—Å –∏ –ø—Ä–∞–≤–¥–∞",
            "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π": "üôè –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π",
            "–°–º–µ—Ä—Ç—å": "üîÑ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –Ω–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ",
            "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å": "üåà –ì–∞—Ä–º–æ–Ω–∏—è –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ",
            "–î—å—è–≤–æ–ª": "üòà –ò—Å–∫—É—à–µ–Ω–∏—è –∏ —Å—Ç—Ä–∞—Å—Ç–∏",
            "–ë–∞—à–Ω—è": "üå©Ô∏è –í–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",
            "–ó–≤–µ–∑–¥–∞": "‚≠ê –ù–∞–¥–µ–∂–¥–∞ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ",
            "–õ—É–Ω–∞": "üåä –¢–∞–π–Ω—ã –∏ –∏–Ω—Ç—É–∏—Ü–∏—è",
            "–°–æ–ª–Ω—Ü–µ": "‚òÄÔ∏è –†–∞–¥–æ—Å—Ç—å –∏ —É—Å–ø–µ—Ö",
            "–°—É–¥": "üìØ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ –∏ –ø—Ä–∏–∑—ã–≤",
            "–ú–∏—Ä": "üïäÔ∏è –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –≥–∞—Ä–º–æ–Ω–∏—è"
        }

        descriptions = [card_meanings.get(card, "üåü –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è") for card in cards]

        predictions = [
            f"""üîÆ –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: {name}, –≤—ã –≤ –ø–µ—Ä–∏–æ–¥–µ –º–æ—â–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π! –í–∞—à –∑–Ω–∞–∫ {zodiac_sign} —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é.

üí´ –ö–∞—Ä—Ç—ã: {chr(10).join(f"‚Ä¢ {desc}" for desc in descriptions)}

üåü –°–æ–≤–µ—Ç: –î–æ–≤–µ—Ä—è–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É –∏ –±—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ.

‚ö° –ë—É–¥—É—â–µ–µ: –í–∞—Å –∂–¥—É—Ç —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!""",

            f"""üîÆ –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: –ü–µ—Ä–∏–æ–¥ –≥–ª—É–±–æ–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è {name}. {zodiac_sign} –¥–∞—ë—Ç –º—É–¥—Ä–æ—Å—Ç—å.

üí´ –ö–∞—Ä—Ç—ã: {chr(10).join(f"‚Ä¢ {desc}" for desc in descriptions)}

üåü –°–æ–≤–µ—Ç: –°–ª—É—à–∞–π—Ç–µ —Å–µ—Ä–¥—Ü–µ, –æ–Ω–æ –∑–Ω–∞–µ—Ç –≤–µ—Ä–Ω—ã–π –ø—É—Ç—å.

‚ö° –ë—É–¥—É—â–µ–µ: –Ø—Ä–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤–ø–µ—Ä–µ–¥–∏!"""
        ]

        return random.choice(predictions)